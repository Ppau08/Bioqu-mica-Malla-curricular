<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Malla Bioquímica Interactiva</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background-color: #111;
      color: #fff;
      display: flex;
      flex-direction: row;
      overflow-x: auto;
    }
    .anio {
      flex: 0 0 16.6%;
      padding: 1rem;
      box-sizing: border-box;
      border-right: 1px solid #444;
    }
    .anio h2 {
      text-align: center;
      margin-bottom: 1rem;
    }
    .cuatrimestre {
      background-color: #222;
      border-radius: 15px;
      padding: 1rem;
      margin-bottom: 1rem;
    }
    .cuatrimestre.verde {
      border: 2px solid green;
    }
    .cuatrimestre.rojo {
      border: 2px solid red;
    }
    .materia {
      background-color: gray;
      border-radius: 10px;
      padding: 0.5rem;
      margin: 0.5rem 0;
      text-align: center;
      font-size: 1rem;
      cursor: pointer;
      transition: 0.3s;
    }
    .materia.desbloqueada {
      background-color: white;
      color: black;
    }
    .materia.regularizada {
      background-color: lightgreen;
      color: black;
    }
    .materia.aprobada {
      background-color: darkgreen;
      color: white;
      text-decoration: line-through;
    }
  </style>
</head>
<body>
  <script>
    const malla = [
      {
        anio: 1,
        cuatrimestres: [
          {
            color: 'verde',
            materias: [
              { nombre: 'Álgebra y Geometría Analítica', id: 'algebra', correlativas: [] },
              { nombre: 'Química General', id: 'quim_gen', correlativas: [] },
            ]
          },
          {
            color: 'rojo',
            materias: [
              { nombre: 'Cálculo Diferencial e Integral', id: 'calculo', correlativas: ['algebra'] },
              { nombre: 'Química Inorgánica', id: 'quim_inorg', correlativas: ['quim_gen'] },
              { nombre: 'Biología General y Celular', id: 'biologia', correlativas: ['quim_gen'] },
            ]
          }
        ]
      },
      // Resto de años se agregan similar
    ];

    const estadoMaterias = {};

    function crearMalla() {
      malla.forEach(anio => {
        const col = document.createElement('div');
        col.className = 'anio';
        col.innerHTML = `<h2>${anio.anio}°</h2>`;

        anio.cuatrimestres.forEach(cuat => {
          const cuatDiv = document.createElement('div');
          cuatDiv.className = `cuatrimestre ${cuat.color}`;

          cuat.materias.forEach(mat => {
            const matDiv = document.createElement('div');
            matDiv.className = 'materia bloqueada';
            matDiv.innerText = mat.nombre;
            matDiv.dataset.id = mat.id;
            matDiv.addEventListener('click', () => cambiarEstado(matDiv));
            estadoMaterias[mat.id] = 'bloqueada';
            cuatDiv.appendChild(matDiv);
          });

          col.appendChild(cuatDiv);
        });

        document.body.appendChild(col);
      });

      actualizarEstados();
    }

    function cambiarEstado(div) {
      const id = div.dataset.id;
      let estado = estadoMaterias[id];

      if (estado === 'bloqueada') return;
      else if (estado === 'desbloqueada') estadoMaterias[id] = 'regularizada';
      else if (estado === 'regularizada') estadoMaterias[id] = 'aprobada';
      else estadoMaterias[id] = 'desbloqueada';

      actualizarEstados();
    }

    function actualizarEstados() {
      document.querySelectorAll('.materia').forEach(div => {
        const id = div.dataset.id;
        div.className = 'materia ' + estadoMaterias[id];
      });

      desbloquearMaterias();
    }

    function desbloquearMaterias() {
      malla.forEach(anio => {
        anio.cuatrimestres.forEach(cuat => {
          cuat.materias.forEach(mat => {
            if (estadoMaterias[mat.id] === 'bloqueada') {
              const puede = mat.correlativas.every(c => estadoMaterias[c] === 'regularizada' || estadoMaterias[c] === 'aprobada');
              if (puede) estadoMaterias[mat.id] = 'desbloqueada';
            }
          });
        });
      });
    }

    crearMalla();
  </script>
</body>
</html>

